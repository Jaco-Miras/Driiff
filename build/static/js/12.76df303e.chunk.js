(this.webpackJsonpdriff=this.webpackJsonpdriff||[]).push([[12],{937:function(e,t,n){},938:function(e,t,n){(function(n){var a,i,r;i=[],void 0===(r="function"===typeof(a=function(){"use strict";function t(e,t,n){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){c(a.response,t,n)},a.onerror=function(){console.error("could not download file")},a.send()}function a(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,o=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,n,o){var c=r.URL||r.webkitURL,l=document.createElement("a");n=n||e.name||"download",l.download=n,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?i(l):a(l.href)?t(e,n,o):i(l,l.target="_blank")):(l.href=c.createObjectURL(e),setTimeout((function(){c.revokeObjectURL(l.href)}),4e4),setTimeout((function(){i(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,r){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,r),n);else if(a(e))t(e,n,r);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout((function(){i(o)}))}}:function(e,n,a,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,a);var c="application/octet-stream"===e.type,l=/constructor/i.test(r.HTMLElement)||r.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||c&&l||o)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},u.readAsDataURL(e)}else{var d=r.URL||r.webkitURL,f=d.createObjectURL(e);i?i.location=f:location.href=f,i=null,setTimeout((function(){d.revokeObjectURL(f)}),4e4)}});r.saveAs=c.saveAs=c,e.exports=c})?a.apply(t,i):a)||(e.exports=r)}).call(this,n(87))},991:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n(7),r=n(6),o=n(0),c=n.n(o),l=n(4),s=n(5),u=n(40),d=n(23),f=(n(937),n(10)),m=n(86),p=n(45),g=n(938);function b(){var e=Object(r.a)(["\n  background-color: #fff;\n  color: #000;\n  padding: 0 2rem 2rem 2rem;\n"]);return b=function(){return e},e}function h(){var e=Object(r.a)(["\n  text-align: center;\n  max-height: 60vh;\n\n  .spinner-border {\n    border-width: 3px;\n    padding: 10px;\n    margin: 5px;\n  }\n  .file {\n    margin: 0 auto;\n    transition: all 0.5s ease;\n    opacity: 1;\n    max-height: 60vh;\n    max-width: 100%;\n\n    &:not([src]) {\n      opacity: 0;\n      max-height: 0;\n    }\n    &[src] {\n      ","\n    }\n\n    &.file-pdf {\n      &:not([data]) {\n        opacity: 0;\n        max-height: 0;\n      }\n      &[data] {\n        ","\n      }\n    }\n  }\n"]);return h=function(){return e},e}function v(){var e=Object(r.a)(["\n  box-sizing: border-box;\n  padding: 0;\n  margin: 0 auto;\n  img {\n    max-width: 100%;\n    max-height: 60vh;\n  }\n"]);return v=function(){return e},e}function w(){var e=Object(r.a)(["\n  opacity: ",";\n  visibility: ",";\n\n  &:focus {\n    outline: none;\n  }\n"]);return w=function(){return e},e}function y(){var e=Object(r.a)(["\n  color: #000;\n  &:focus {\n    outline: none;\n  }\n"]);return y=function(){return e},e}function j(){var e=Object(r.a)(["\n  position: relative;\n"]);return j=function(){return e},e}function O(){var e=Object(r.a)(['\n  position: relative;\n  top: 0;\n  margin: 0 auto;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  background-color: rgba(24, 24, 26, 0.5);\n\n  :before {\n    background-color: rgba(0, 0, 0, 0.8);\n    opacity: 0.5;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    content: "";\n    display: block;\n    z-index: -1;\n  }\n\n  .iframe {\n    width: 100%;\n    height: 100%;\n    display: block;\n    margin-left: auto;\n    margin-right: auto;\n  }\n  .mfp-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  .mfp-content {\n    /* margin-top: -20px; */\n\n    .mfp-close {\n      position: absolute;\n      width: 22px;\n      right: 10px;\n      color: #000;\n    }\n  }\n  .mfp-figure {\n    position: relative;\n    padding: 32px;\n    background-color: #fff;\n    border-bottom: 2px solid #ccc;\n    &::after {\n      top: 58px;\n      bottom: 0;\n    }\n  }\n  .mfp-bottom-bar {\n    margin-top: 0;\n  }\n']);return O=function(){return e},e}function k(){var e=Object(r.a)(["\n  width: 100%;\n  display: block;\n  font-size: 11px;\n  font-weight: normal;\n  text-align: left;\n  margin: 0;\n"]);return k=function(){return e},e}function x(){var e=Object(r.a)(["\n  position: relative;\n  z-index: 1;\n  display: inline-block;\n  font-size: 16px;\n  font-weight: 500;\n  margin: 0;\n  color: #000;\n\n  &:hover {\n    text-decoration: none;\n    color: #000;\n    cursor: pointer;\n  }\n"]);return x=function(){return e},e}function E(){var e=Object(r.a)(["\n  display: block;\n  text-align: left;\n  margin-bottom: 0;\n"]);return E=function(){return e},e}function _(){var e=Object(r.a)([""]);return _=function(){return e},e}function S(){var e=Object(r.a)(["\n  position: relative;\n  top: -3px;\n  margin-right: 5px;\n"]);return S=function(){return e},e}function L(){var e=Object(r.a)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: auto;\n  align-items: center;\n  justify-content: space-evenly;\n  font-size: 2.5rem;\n  color: #000;\n  z-index: 9999;\n  .fas {\n    cursor: pointer;\n  }\n  .cannot-preview {\n    min-width: 40vw;\n    min-height: 40vh;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    color: #cccccc;\n    text-align: center;\n    p {\n      font-size: 1.1rem;\n      line-height: 1.4rem;\n      margin: 2rem 0 1.5rem 0;\n    }\n    svg {\n      width: 48px;\n      height: 48px;\n    }\n  }\n  .iframe.file {\n    min-width: 60vw;\n    min-height: 60vh;\n  }\n"]);return L=function(){return e},e}var N=s.b.div(L()),T=Object(s.b)(m.c)(S()),R=Object(s.b)(m.c)(_()),A=s.b.p(E()),D=s.b.span(x()),F=s.b.p(k()),C=s.b.div(O()),U=s.b.div(j()),z=s.b.button(y()),B=s.b.button(w(),(function(e){return e.show?"1":"0"}),(function(e){return e.show?"visible":"hidden"})),M=s.b.figure(v()),W=s.b.div(h(),(function(e){return e.isLoaded?"\n        opacity: 1;\n        max-height: 60vh;      \n      ":"\n        opacity: 0;\n        max-height: 0;\n      "}),(function(e){return e.isLoaded?"\n          max-width: 1060px;\n          max-height: 100%;\n          opacity: 1;\n        ":"\n          opacity: 0;\n          max-height: 0;\n        "})),I=s.b.div(b()),P=function(e){var t=e.className,r=void 0===t?"":t,s=e.file,m=e.setFiles,b=e.files,h=e.viewFiles,v=Object(f.z)().slug,w=Object(l.c)(),y=Object(f.Db)(),j=Object(f.u)(),O=j.fileBlobs,k=j.actions.setFileSrc,x=Object(l.d)((function(e){return e.workspaces.activeTopic})),E=Object(o.useState)(!1),_=Object(i.a)(E,2),S=_[0],L=_[1],N=Object(l.d)((function(e){return e.workspaces.sharedWorkspaces})),T=Object(l.d)((function(e){return e.workspaces.sharedWorkspaces[h.slug]})),A={},D=Object(o.useRef)(),F="".concat(s.id,"-").concat(v);h.sharedSlug&&(F="".concat(s.id,"-").concat(h.slug)),Object(o.useEffect)((function(){O[F]?L(!0):(L(!1),p.sessionService.loadSession().then((function(e){var t=e.token;h&&h.sharedSlug&&e.sharedWorkspaces[h.slug]&&(t="Bearer ".concat(e.sharedWorkspaces[h.slug].access_token)),h.workspace_id&&x&&x.sharedSlug&&N[x.slug]&&(t="Bearer ".concat(N[x.slug].access_token)),fetch(s.view_link,{method:"GET",keepalive:!0,headers:{Authorization:t,"Access-Control-Allow-Origin":"*",Connection:"keep-alive",crossorigin:!0}}).then((function(e){return e.blob()})).then((function(e){var t=URL.createObjectURL(e);m(b.map((function(e){return e.id===s.id?Object(a.a)(Object(a.a)({},e),{},{imgSrc:t}):e}))),k({id:s.id,src:t,key:F},(function(){L(!0)}))})).catch((function(e){console.log("error fetching image"),L(!0)}))})))}),[s]);var C=s.type.toLowerCase();return C.includes("video")?c.a.createElement(W,{isLoaded:S,key:s.id,"data-index":s.id,className:"file-item mfp-img ".concat(r)},S?c.a.createElement(c.a.Fragment,null,c.a.createElement("img",{className:"d-none",src:n(430),alt:"File not found."}),c.a.createElement("video",{key:s.id,ref:D,"data-attempt":0,className:"file opacity-0","data-index":s.id,controls:!0,playsInline:!0,autoPlay:!1,onLoadStart:function(e){e.currentTarget.classList.remove("d-none"),e.currentTarget.classList.remove("opacity-0"),e.currentTarget.removeAttribute("height")},onError:function(e){if("0"===e.currentTarget.dataset.attempt){e.currentTarget.dataset.attempt=1;var t=h.workspace_id&&x&&x.sharedSlug&&N[x.slug]?N[x.slug].auth_token:h.sharedSlug?T.auth_token:localStorage.getItem("atoken");e.currentTarget.src="".concat(Object(u.a)({isDNS:!0,sharedSlug:h.slug||(null===x||void 0===x?void 0:x.slug)}),"/file-view-attempt/").concat(s.file_id,"/").concat(t)}else{document.querySelector('.file-item[data-index="'.concat(e.currentTarget.dataset.index,'"] img')).classList.remove("d-none"),document.querySelector('.file-item[data-index="'.concat(e.currentTarget.dataset.index,'"] video')).classList.add("d-none")}}},c.a.createElement("source",{src:"".concat(s.view_link,"?playsinline=1"),type:s.type}),"Your browser does not support the video tag.")):c.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})):"image"===C?c.a.createElement(W,{isLoaded:S,key:s.id,"data-index":s.id,className:"file-item mfp-img ".concat(r)},S?c.a.createElement(c.a.Fragment,null,c.a.createElement("img",{className:"file","data-index":s.id,"data-attempt":0,onError:function(e){"0"===e.currentTarget.dataset.attempt?(e.currentTarget.dataset.attempt=1,e.currentTarget.src="".concat(Object(u.a)({isDNS:!0}),"/file-view-attempt/").concat(s.file_id,"/").concat(localStorage.getItem("atoken"))):"1"===e.currentTarget.dataset.attemp?(e.currentTarget.dataset.attempt=2,e.currentTarget.src="".concat(e.currentTarget.src,"&timestamp=").concat((new Date).getTime())):(e.currentTarget.classList.add("img-error"),e.currentTarget.src=n(430))},ref:function(e){return A[s.id]=e},key:s.id,src:O[F],alt:s.filename?s.filename:s.search})):c.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})):"pdf"===C?c.a.createElement(W,{isLoaded:S,key:s.id,"data-index":s.id,className:"file-item mfp-img ".concat(r)},S?c.a.createElement(c.a.Fragment,null,c.a.createElement("object",{className:"file file-pdf",data:O[s.id],width:.9*y.width,height:y.height-122,onLoad:function(e){}},c.a.createElement("embed",{src:O[s.id],width:"600",height:"400"}))):c.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})):c.a.createElement(W,{isLoaded:S,key:s.id,"data-index":s.id,className:"file-item mfp-img cannot-preview ".concat(r)},c.a.createElement(R,{icon:"eye-off"}),c.a.createElement("p",null,s.search?s.search:s.filename,"We can't preview this file type. ",c.a.createElement("br",null),"Try downloading the file to view it."),c.a.createElement("button",{className:"btn btn-primary",onClick:function(e){return function(e,t){if(t.remove_on_download){var n={file_id:t.file_id};h.topic_id&&(n=Object(a.a)(Object(a.a)({},n),{},{topic_id:h.topic_id})),w(Object(d.bc)(n))}e.preventDefault();var i=h.workspace_id&&x&&x.sharedSlug&&N[x.slug]?N[x.slug].auth_token:h.sharedSlug?T.auth_token:localStorage.getItem("atoken"),r="".concat(Object(u.a)({isDNS:!0,sharedSlug:h.slug||(null===x||void 0===x?void 0:x.slug)}),"/file-view-attempt/").concat(t.file_id,"/").concat(i);Object(g.saveAs)(r,t.filename?t.filename:t.search?t.search:t.name)}(e,s)}},"Download ",s.search))};t.default=c.a.memo((function(e){var t=e.className,n=void 0===t?"":t,r=Object(f.z)().slug,s=Object(o.useRef)(),m=Object(l.c)(),p=Object(l.d)((function(e){return e.files.channelFiles})),b=Object(l.d)((function(e){return e.files.viewFiles})),h=Object(l.d)((function(e){return e.files.workspaceFiles})),v=Object(l.d)((function(e){return e.workspaces.activeTopic})),w=Object(f.hb)().localizeDate,y=Object(l.d)((function(e){return e.workspaces.sharedWorkspaces[null===v||void 0===v?void 0:v.slug]})),j=Object(o.useState)(0),O=Object(i.a)(j,2),k=O[0],x=O[1],E=Object(o.useState)([]),_=Object(i.a)(E,2),S=_[0],L=_[1],R=function(){var e=S.length;x(e-1===k?0:k+1)},W=function(){var e=S.length;x(0===k?e-1:k-1)},H=function(e){e.preventDefault(),e.stopPropagation(),m(Object(d.fc)(null))},q=function(e,t){if(t.remove_on_download){var n={file_id:t.file_id};b.topic_id&&(n=Object(a.a)(Object(a.a)({},n),{},{topic_id:b.topic_id})),m(Object(d.bc)(n))}e.preventDefault();var i=null===y||void 0===y?void 0:y.auth_token,r="".concat(Object(u.a)({isDNS:!0,sharedSlug:null===v||void 0===v?void 0:v.slug}),"/file-view-attempt/").concat(t.file_id,"/").concat(i);t.imgSrc&&(r=URL.getFromObjectURL(t.imgSrc)),Object(g.saveAs)(r,t.filename?t.filename:t.search?t.search:t.name)};Object(o.useEffect)((function(){var e="".concat(b.workspace_id,"-").concat(r);if(b.sharedSlug&&(e="".concat(b.workspace_id,"-").concat(b.slug)),Object.keys(p).length&&p.hasOwnProperty(b.channel_id))L(p[b.channel_id]),p[b.channel_id].forEach((function(e,t){e.file_id===b.file_id&&x(t)}));else if(Object.keys(h).length&&h.hasOwnProperty(e)){var t=Object.values(h[e].files);b.hasOwnProperty("files")&&(t=b.files),L(t),x(t.findIndex((function(e){return e.id===b.file_id})))}else b.files&&b.files.length&&(L(b.files),x(b.files.findIndex((function(e){return e.file_id===b.file_id}))))}),[]),Object(o.useEffect)((function(){if(s.current){var e=function(e){switch(e.keyCode){case 27:H(e);break;case 39:R();break;case 37:W();break;default:return null}};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}}),[s]),Object(f.J)(s,(function(){m(Object(d.fc)(null))}),!0);var J=S[k];if(0!==S.length&&null!==k&&"undefined"!==typeof J)return c.a.createElement(N,{className:"fileviewer-container ".concat(n),"data-file-index":k},c.a.createElement(C,{className:"iframe-img-container"},c.a.createElement("div",{className:"mfp-container mfp-s-ready mfp-image-holder"},c.a.createElement("div",{ref:s},c.a.createElement("div",{className:"mfp-content"},c.a.createElement("div",{className:"d-flex justify-content-between align-items-center"}),c.a.createElement("div",{className:"mfp-figure rounded-top"},c.a.createElement(z,{onClick:function(e){return H(e)},title:"Close (Esc)",type:"button",className:"mfp-close"},"\xd7"),c.a.createElement(M,null,c.a.createElement(P,{files:S,file:S[k],setFiles:L,viewFiles:b}))),c.a.createElement(I,{className:"d-flex justify-content-between align-items-end rounded-bottom"},c.a.createElement(U,null,c.a.createElement(A,null,c.a.createElement(D,{onClick:function(e){return q(e,J)}},J.filename?J.filename:J.search)),J.created_at&&J.created_at.timestamp&&c.a.createElement(F,null,w(J.created_at.timestamp)," \u25cf ",J.type.toLowerCase())),c.a.createElement("button",{className:"btn btn-primary",onClick:function(e){return q(e,J)}},c.a.createElement(T,{icon:"download"})," Download")),c.a.createElement("figcaption",null,c.a.createElement("div",{className:"mfp-bottom-bar"},c.a.createElement("div",{className:"mfp-title"}),c.a.createElement("div",{className:"mfp-counter"},"".concat(k+1," of ").concat(S.length))))),c.a.createElement("div",{className:"mfp-preloader"},"Loading..."),c.a.createElement(B,{show:S.length>1,onClick:function(e){return W()},title:"Previous (Left arrow key)",type:"button",className:"mfp-arrow mfp-arrow-left mfp-prevent-close"}),c.a.createElement(B,{show:S.length>1,onClick:function(e){return R()},title:"Next (Right arrow key)",type:"button",className:"mfp-arrow mfp-arrow-right mfp-prevent-close"})))))}))}}]);