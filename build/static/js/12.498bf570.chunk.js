(this.webpackJsonpdriff=this.webpackJsonpdriff||[]).push([[12],{846:function(e,n,t){},893:function(e,n,t){"use strict";t.r(n);var a=t(1),i=t(7),r=t(5),c=t(0),o=t.n(c),l=t(6),s=t(4),d=t(33),f=t(21),u=(t(846),t(11)),m=t(86),p=t(47);function b(){var e=Object(r.a)(["\n  text-align: center;\n\n  .spinner-border {\n    border-width: 3px;\n    padding: 10px;\n    margin: 5px;\n  }\n  .file {\n    margin: 0 auto;\n    transition: all 0.5s ease;\n    opacity: 1;\n    max-height: 80vh;\n    max-width: 100%;\n\n    &:not([src]) {\n      opacity: 0;\n      max-height: 0;\n    }\n    &[src] {\n      ","\n    }\n\n    &.file-pdf {\n      &:not([data]) {\n        opacity: 0;\n        max-height: 0;\n      }\n      &[data] {\n        ","\n      }\n    }\n  }\n"]);return b=function(){return e},e}function g(){var e=Object(r.a)(["\n  box-sizing: border-box;\n  padding: 0;\n  margin: 0 auto;\n  img {\n    max-width: 100%;\n    max-height: 80vh;\n  }\n"]);return g=function(){return e},e}function h(){var e=Object(r.a)(["\n  opacity: ",";\n  visibility: ",";\n\n  &:focus {\n    outline: none;\n  }\n"]);return h=function(){return e},e}function v(){var e=Object(r.a)(["\n  &:focus {\n    outline: none;\n  }\n"]);return v=function(){return e},e}function w(){var e=Object(r.a)(["\n  position: relative;\n"]);return w=function(){return e},e}function x(){var e=Object(r.a)(['\n  position: relative;\n  top: 0;\n  margin: 0 auto;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  background-color: rgba(24, 24, 26, 0.5);\n\n  :before {\n    background-color: rgba(0, 0, 0, 0.8);\n    opacity: 0.5;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    content: "";\n    display: block;\n    z-index: -1;\n  }\n\n  .iframe {\n    width: 100%;\n    height: 100%;\n    display: block;\n    margin-left: auto;\n    margin-right: auto;\n  }\n  .mfp-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  .mfp-content {\n    margin-top: -20px;\n\n    .mfp-close {\n      position: relative;\n      width: 22px;\n    }\n  }\n  .mfp-figure {\n    &::after {\n      top: 58px;\n      bottom: 0;\n    }\n  }\n  .mfp-bottom-bar {\n    margin-top: 0;\n  }\n']);return x=function(){return e},e}function j(){var e=Object(r.a)(["\n  width: 100%;\n  display: block;\n  font-size: 11px;\n  font-weight: normal;\n  text-align: left;\n  margin: 0;\n"]);return j=function(){return e},e}function y(){var e=Object(r.a)(["\n  position: relative;\n  z-index: 1;\n  display: inline-block;\n  font-size: 16px;\n  font-weight: 500;\n  margin: 0;\n  color: #fff;\n\n  &:hover {\n    text-decoration: none;\n    color: #fff;\n    cursor: pointer;\n  }\n"]);return y=function(){return e},e}function O(){var e=Object(r.a)(["\n  display: block;\n  text-align: left;\n  margin-bottom: 0;\n"]);return O=function(){return e},e}function E(){var e=Object(r.a)([""]);return E=function(){return e},e}function k(){var e=Object(r.a)(["\n  position: relative;\n  top: -3px;\n  margin-right: 5px;\n"]);return k=function(){return e},e}function _(){var e=Object(r.a)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: auto;\n  align-items: center;\n  justify-content: space-evenly;\n  font-size: 2.5rem;\n  color: #fff;\n  z-index: 9999;\n  .fas {\n    cursor: pointer;\n  }\n  .cannot-preview {\n    min-width: 40vw;\n    min-height: 40vh;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    color: #cccccc;\n    text-align: center;\n    p {\n      font-size: 1.1rem;\n      line-height: 1.4rem;\n      margin: 2rem 0 1.5rem 0;\n    }\n    svg {\n      width: 48px;\n      height: 48px;\n    }\n  }\n  .iframe.file {\n    min-width: 80vw;\n    min-height: 80vh;\n  }\n"]);return _=function(){return e},e}var N=s.b.div(_()),L=Object(s.b)(m.c)(k()),T=Object(s.b)(m.c)(E()),S=s.b.p(O()),F=s.b.span(y()),C=s.b.p(j()),z=s.b.div(x()),D=s.b.div(w()),P=s.b.button(v()),I=s.b.button(h(),(function(e){return e.show?"1":"0"}),(function(e){return e.show?"visible":"hidden"})),A=s.b.figure(g()),R=s.b.div(b(),(function(e){return e.isLoaded?"\n        opacity: 1;\n        max-height: 80vh;      \n      ":"\n        opacity: 0;\n        max-height: 0;\n      "}),(function(e){return e.isLoaded?"\n          max-width: 1060px;\n          max-height: 100%;\n          opacity: 1;\n        ":"\n          opacity: 0;\n          max-height: 0;\n        "})),q=function(e){var n=e.className,r=void 0===n?"":n,s=e.file,m=e.setFiles,b=e.files,g=e.viewFiles,h=Object(l.c)(),v=Object(u.wb)(),w=Object(u.t)(),x=w.fileBlobs,j=w.actions.setFileSrc,y=Object(c.useState)(!1),O=Object(i.a)(y,2),E=O[0],k=O[1],_={};Object(c.useEffect)((function(){x[s.id]?k(!0):(k(!1),p.sessionService.loadSession().then((function(e){var n=e.token;fetch(s.view_link,{method:"GET",keepalive:!0,headers:{Authorization:n,"Access-Control-Allow-Origin":"*",Connection:"keep-alive",crossorigin:!0}}).then((function(e){return e.blob()})).then((function(e){var n=URL.createObjectURL(e);m(b.map((function(e){return e.id===s.id?Object(a.a)(Object(a.a)({},e),{},{imgSrc:n}):e}))),j({id:s.id,src:n},(function(){k(!0)}))})).catch((function(e){console.log("error fetching image")}))})))}),[s]);var N=s.type.toLowerCase();return N.includes("video")?o.a.createElement(R,{isLoaded:E,key:s.id,"data-index":s.id,className:"file-item mfp-img ".concat(r)},E?o.a.createElement(o.a.Fragment,null,o.a.createElement("img",{className:"d-none",src:t(392),alt:"File not found."}),o.a.createElement("video",{className:"file opacity-0","data-index":s.id,"data-attempt":0,ref:function(e){return _[s.id]=e},controls:!0,playsInline:!0,key:s.id,autoPlay:!1,onLoadStart:function(e){e.currentTarget.classList.remove("d-none"),e.currentTarget.removeAttribute("height")},onError:function(e){"0"===e.currentTarget.dataset.attempt?(e.currentTarget.dataset.attempt=1,e.currentTarget.src="".concat(Object(d.a)({isDNS:!0}),"/file-view-attempt/").concat(s.file_id,"/").concat(localStorage.getItem("atoken"))):(document.querySelector('.file-item[data-index="'.concat(e.currentTarget.dataset.index,'"] img')).classList.remove("d-none"),document.querySelector('.file-item[data-index="'.concat(e.currentTarget.dataset.index,'"] video')).classList.add("d-none"))},src:x[s.id]})):o.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})):"image"===N?o.a.createElement(R,{isLoaded:E,key:s.id,"data-index":s.id,className:"file-item mfp-img ".concat(r)},E?o.a.createElement(o.a.Fragment,null,o.a.createElement("img",{className:"file","data-index":s.id,"data-attempt":0,onError:function(e){"0"===e.currentTarget.dataset.attempt?(e.currentTarget.dataset.attempt=1,e.currentTarget.src="".concat(Object(d.a)({isDNS:!0}),"/file-view-attempt/").concat(s.file_id,"/").concat(localStorage.getItem("atoken"))):"1"===e.currentTarget.dataset.attemp?(e.currentTarget.dataset.attempt=2,e.currentTarget.src="".concat(e.currentTarget.src,"&timestamp=").concat((new Date).getTime())):(e.currentTarget.classList.add("img-error"),e.currentTarget.src=t(392))},ref:function(e){return _[s.id]=e},key:s.id,src:x[s.id],alt:s.filename?s.filename:s.search})):o.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})):"pdf"===N?o.a.createElement(R,{isLoaded:E,key:s.id,"data-index":s.id,className:"file-item mfp-img ".concat(r)},E?o.a.createElement(o.a.Fragment,null,o.a.createElement("object",{className:"file file-pdf",data:x[s.id],width:.9*v.width,height:v.height-122,onLoad:function(e){}},o.a.createElement("embed",{src:x[s.id],width:"600",height:"400"}))):o.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})):o.a.createElement(R,{isLoaded:E,key:s.id,"data-index":s.id,className:"file-item mfp-img cannot-preview ".concat(r)},o.a.createElement(T,{icon:"eye-off"}),o.a.createElement("p",null,s.search?s.search:s.filename,"We can't preview this file type. ",o.a.createElement("br",null),"Try downloading the file to view it."),o.a.createElement("button",{className:"btn btn-primary",onClick:function(e){return function(e,n){if(n.remove_on_download){var t={file_id:n.file_id};g.topic_id&&(t=Object(a.a)(Object(a.a)({},t),{},{topic_id:g.topic_id})),h(Object(f.ac)(t))}e.preventDefault(),window.open(n.download_link,"_self").blur(),window.focus()}(e,s)}},"Download ",s.search))};n.default=o.a.memo((function(e){var n=e.className,t=void 0===n?"":n,r=Object(c.useRef)(),s=Object(l.c)(),d=Object(l.d)((function(e){return e.files.channelFiles})),m=Object(l.d)((function(e){return e.files.viewFiles})),p=Object(l.d)((function(e){return e.files.workspaceFiles})),b=Object(u.bb)().localizeDate,g=Object(c.useState)(0),h=Object(i.a)(g,2),v=h[0],w=h[1],x=Object(c.useState)([]),j=Object(i.a)(x,2),y=j[0],O=j[1],E=function(){var e=y.length;w(e-1===v?0:v+1)},k=function(){var e=y.length;w(0===v?e-1:v-1)},_=function(e){e.preventDefault(),e.stopPropagation(),s(Object(f.ec)(null))};Object(c.useEffect)((function(){if(Object.keys(d).length&&d.hasOwnProperty(m.channel_id))O(d[m.channel_id]),d[m.channel_id].forEach((function(e,n){e.file_id===m.file_id&&w(n)}));else if(Object.keys(p).length&&p.hasOwnProperty(m.workspace_id)){var e=Object.values(p[m.workspace_id].files);m.hasOwnProperty("files")&&(e=m.files),O(e),w(e.findIndex((function(e){return e.id===m.file_id})))}else m.files&&m.files.length&&(O(m.files),w(m.files.findIndex((function(e){return e.file_id===m.file_id}))))}),[]),Object(c.useEffect)((function(){if(r.current){var e=function(e){switch(e.keyCode){case 27:_(e);break;case 39:E();break;case 37:k();break;default:return null}};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}}),[r]),Object(u.G)(r,(function(){s(Object(f.ec)(null))}),!0);var T=y[v];if(0!==y.length&&null!==v&&"undefined"!==typeof T)return o.a.createElement(N,{className:"fileviewer-container ".concat(t),"data-file-index":v},o.a.createElement(z,{className:"iframe-img-container"},o.a.createElement("div",{className:"mfp-container mfp-s-ready mfp-image-holder"},o.a.createElement("div",{ref:r},o.a.createElement("div",{className:"mfp-content"},o.a.createElement("div",{className:"d-flex justify-content-between align-items-start"},o.a.createElement(D,null,o.a.createElement(S,null,o.a.createElement(F,{onClick:function(e){return function(e,n){if(n.remove_on_download){var t={file_id:n.file_id};m.topic_id&&(t=Object(a.a)(Object(a.a)({},t),{},{topic_id:m.topic_id})),s(Object(f.ac)(t))}e.preventDefault(),window.open(n.download_link,"_self").blur(),window.focus()}(e,T)}},o.a.createElement(L,{icon:"download"})," ",T.filename?T.filename:T.search)),T.created_at&&T.created_at.timestamp&&o.a.createElement(C,null,b(T.created_at.timestamp)," \u25cf ",T.type.toLowerCase())),o.a.createElement(P,{onClick:function(e){return _(e)},title:"Close (Esc)",type:"button",className:"mfp-close"},"\xd7")),o.a.createElement("div",{className:"mfp-figure"},o.a.createElement(A,null,o.a.createElement(q,{files:y,file:y[v],setFiles:O,viewFiles:m}),o.a.createElement("figcaption",null,o.a.createElement("div",{className:"mfp-bottom-bar"},o.a.createElement("div",{className:"mfp-title"}),o.a.createElement("div",{className:"mfp-counter"},"".concat(v+1," of ").concat(y.length))))))),o.a.createElement("div",{className:"mfp-preloader"},"Loading..."),o.a.createElement(I,{show:y.length>1,onClick:function(e){return k()},title:"Previous (Left arrow key)",type:"button",className:"mfp-arrow mfp-arrow-left mfp-prevent-close"}),o.a.createElement(I,{show:y.length>1,onClick:function(e){return E()},title:"Next (Right arrow key)",type:"button",className:"mfp-arrow mfp-arrow-right mfp-prevent-close"})))))}))}}]);